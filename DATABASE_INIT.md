# 数据库初始化说明

## 🎯 目标状态

确保数据库完全干净，只包含必要的初始数据，没有任何示例视频。

## 📋 当前数据库状态

运行种子脚本后，数据库将包含：

### ✅ 用户账号 (2个)
- **学生账号**: `student@example.com` (张同学) - 角色: STUDENT
- **管理员账号**: `admin@tiffanyscollege.com` (管理员) - 角色: ADMIN

### ✅ 视频分类 (4个)
- **写作技能** (writing)
- **口语表达** (speaking) 
- **阅读策略** (reading)
- **听力技巧** (listening)

### ✅ 订阅计划 (2个)
- **基础版** (basic) - ¥299/30天
- **高级版** (premium) - ¥799/90天

### ✅ 视频数量
- **0个视频** - 等待管理员上传

## 🚀 初始化步骤

### 1. 生成Prisma客户端
```bash
npx prisma generate
```

### 2. 推送数据库架构
```bash
npx prisma db push
```

### 3. 运行种子脚本
```bash
npx tsx prisma/seed.ts
```

### 4. 验证数据库状态
```bash
node test-db-connection.js
```

## 🔍 验证要点

### 用户验证
- [ ] 只有2个用户账号
- [ ] 学生账号有基础版订阅
- [ ] 管理员账号有ADMIN角色

### 分类验证
- [ ] 只有4个视频分类
- [ ] 分类名称和显示名称正确
- [ ] 分类状态为激活

### 视频验证
- [ ] 视频数量为0
- [ ] 没有示例视频数据
- [ ] 视频表完全清空

### 订阅验证
- [ ] 只有2个订阅计划
- [ ] 学生账号有有效订阅
- [ ] 订阅状态为ACTIVE

## 📝 管理员操作流程

### 1. 登录管理员账号
- 邮箱: `admin@tiffanyscollege.com`
- 角色: ADMIN

### 2. 进入视频管理页面
- 路径: `/admin/video-management`
- 功能: 上传、管理、权限控制

### 3. 上传视频
- 选择视频文件
- 填写标题、描述、分类
- 设置访问级别
- 创建视频记录

### 4. 管理访问权限
- 为学生分配视频访问权限
- 设置访问类型和过期时间
- 管理用户权限

## 🎬 学生观看流程

### 1. 登录学生账号
- 邮箱: `student@example.com`
- 角色: STUDENT

### 2. 访问视频页面
- 路径: `/videos`
- 显示有权限的视频

### 3. 观看视频
- 基于订阅计划访问
- 基于直接权限访问
- 记录观看进度

## ⚠️ 注意事项

1. **不要运行旧的种子脚本** - 可能包含示例视频
2. **确保数据库完全清空** - 删除所有现有数据
3. **验证用户权限** - 确保角色和订阅正确
4. **测试视频上传** - 验证管理员功能正常
5. **测试学生访问** - 验证权限控制正常

## 🔧 故障排除

### 常见问题

1. **Prisma客户端错误**
   - 运行 `npx prisma generate`
   - 检查 `@prisma/client` 依赖

2. **数据库连接失败**
   - 检查 `.env.local` 配置
   - 验证数据库服务状态

3. **权限验证失败**
   - 检查用户角色设置
   - 验证会话状态

4. **视频不显示**
   - 检查访问权限设置
   - 验证订阅状态

## 📞 技术支持

如遇问题，请检查：
1. 控制台错误信息
2. 网络请求状态
3. 数据库连接日志
4. 用户权限设置

---

**最后更新**: 2024年12月  
**状态**: ✅ 准备就绪
